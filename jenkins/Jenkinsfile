pipeline {
    agent any

    environment {
        // Replace with your actual values
        ANSIBLE_HOST = 'user@ansible-machine-ip-or-hostname'
        PROJECT_DIR = '~/disaster_recovery_project'
        ANSIBLE_DIR = '~/disaster_recovery_project/ansible'
        SSH_KEY = credentials('rg12.pem') // Add this SSH key in Jenkins credentials
    }

    stages {
    stage('Deploy via Ansible') {
        steps {
            sshagent (credentials: ['rg12.pem']) {
                script {
                    sh '''
                    ssh -o StrictHostKeyChecking=no $ANSIBLE_HOST << 'ENDSSH'
                    set -e

                    cd ~/disaster_recovery_project

                    git fetch --all
                    git reset --hard origin/$(git rev-parse --abbrev-ref HEAD)
                    git pull -X theirs origin $(git rev-parse --abbrev-ref HEAD)

                    cd ~/disaster_recovery_project/ansible
                    ansible-playbook -i inventory.ini deploy.yaml
                    ENDSSH
                    '''
                }
            }
        }
    }
}
}
